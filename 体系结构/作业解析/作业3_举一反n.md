
## 例题 1：8-entry 全相联 TLB + LRU + 给定访问序列，求 PA 与最终 TLB（非常经典）

来源：CS61C 讨论课解答 PDF

### 题目（等价复述）

- 虚拟地址：16-bit；页大小：256B（所以 Offset=8bit，VPN=8bit）
    
- TLB：8 项、全相联，LRU 替换；LRU=0 表示最近使用
    
- 初始 TLB（VPN/PPN/V/D/LRU）：
    

|VPN|PPN|V|D|LRU|
|---|---|---|---|---|
|0x01|0x11|1|1|0|
|—|—|0|0|7|
|0x10|0x13|1|1|1|
|0x20|0x12|1|0|5|
|—|—|0|0|6|
|0x11|0x14|1|0|4|
|0xAC|0x15|1|1|2|
|0xFF|0xFF|1|0|3|

- 空闲物理页：0x17, 0x18, 0x19
    
- 假设：当前所有有效页表项都已在初始 TLB 中（即 **TLB miss ⇒ page fault，需要分配新物理页**）
    
- 访问序列（虚拟地址 + 读写）：
    
    1. 0x11F0 (R)
        
    2. 0x1301 (W)
        
    3. 0x20AE (W)
        
    4. 0x2332 (W)
        
    5. 0x20FF (R)
        
    6. 0x3415 (W)
        

要求：写出每次访问的**物理地址 PA**，并给出**最终 TLB**。

---

### 解答（完整）

页大小 256B ⇒ Offset=低 8 bit，VPN=高 8 bit；PA = (PPN<<8) | Offset。

**(1) 0x11F0 (R)**

- VPN=0x11，Offset=0xF0
    
- TLB 命中：0x11→0x14
    
- PA = 0x14F0
    
- LRU：VPN 0x11 变 MRU（LRU=0）
    

**(2) 0x1301 (W)**

- VPN=0x13，Offset=0x01
    
- TLB miss ⇒ page fault：分配空闲页 0x17 给 VPN 0x13
    
- 写访问 ⇒ D=1
    
- PA = 0x1701
    
- TLB 中找空槽（有无效项）填入 VPN 0x13→PPN 0x17
    

**(3) 0x20AE (W)**

- VPN=0x20，Offset=0xAE
    
- TLB hit：0x20→0x12
    
- 写 ⇒ 把该项 D 置 1（原来 D=0）
    
- PA = 0x12AE
    

**(4) 0x2332 (W)**

- VPN=0x23，Offset=0x32
    
- TLB miss ⇒ page fault：分配空闲页 0x18 给 VPN 0x23，D=1
    
- PA = 0x1832
    
- 继续填入另一个空槽（无效项）
    

**(5) 0x20FF (R)**

- VPN=0x20，Offset=0xFF
    
- hit：0x20→0x12
    
- PA = 0x12FF
    

**(6) 0x3415 (W)**

- VPN=0x34，Offset=0x15
    
- miss ⇒ page fault：分配空闲页 0x19 给 VPN 0x34，D=1
    
- 此时 TLB 已满，需要 LRU 替换：替换最久未用的一项（本题解中被替换的是 VPN=0xFF）
    
- PA = 0x1915
    

**最终 PA 列表：**  
0x14F0, 0x1701, 0x12AE, 0x1832, 0x12FF, 0x1915

**最终 TLB：**

|VPN|PPN|V|D|LRU|
|---|---|---|---|---|
|0x01|0x11|1|1|5|
|0x13|0x17|1|1|3|
|0x10|0x13|1|1|6|
|0x20|0x12|1|1|1|
|0x23|0x18|1|1|2|
|0x11|0x14|1|0|4|
|0xAC|0x15|1|1|7|
|0x34|0x19|1|1|0|

---

## 例题 2：同样是 TLB+LRU，但加入权限位与 Protection Fault

来源：UW CSE351 Section 8 解答 PDF

### 题目（等价复述）

- 16-bit VA，页 256B，TLB 8-entry 全相联 LRU（0 最近）
    
- TLB 项含：VPN、PPN、Valid、R/W/X、Dirty、LRU
    
- 约定：**不在初始 TLB 的页表项**都默认 R=1,W=1,X=0；发生 page fault 时 OS 从 PPN=0x20 开始分配新页（再 0x21…）
    
- 访问序列：
    
    1. Read 0x11F0
        
    2. Write 0x0301
        
    3. Write 0x20AE
        
    4. Write 0x0532
        
    5. Read 0x0E15
        
    6. Write 0xACFF
        

要求：每次访问判断 **TLB hit/miss、是否 page fault、是否 protection fault**，并写出最终 TLB。

---

### 解答（按访问逐步）

关键：VPN=高 8 bit。

1. **R 0x11F0**：VPN=0x11，在初始 TLB 中 ⇒ **TLB hit**，无 page fault。
    
2. **W 0x0301**：VPN=0x03 不在 TLB ⇒ **TLB miss**；但页表中该 VPN 有效 ⇒ **无 page fault**（把该映射装入 TLB，替换 LRU 项）。
    
3. **W 0x20AE**：VPN=0x20 在 TLB ⇒ **hit**；写操作会把该项 Dirty 置 1。
    
4. **W 0x0532**：VPN=0x05 不在 TLB 且页表无效 ⇒ **TLB miss + page fault**；OS 分配新页 **PPN=0x20**，并装入 TLB（替换 LRU）。
    
5. **R 0x0E15**：VPN=0x0E ⇒ **miss + page fault**；OS 分配 **PPN=0x21**，装入 TLB。
    
6. **W 0xACFF**：VPN=0xAC 在 TLB ⇒ **TLB hit**；但该项 W=0（不可写）⇒ **Protection fault**（注意：命中≠一定允许访问）。
    

**最终 TLB（题解给出的最终状态之一）：**

|VPN|PPN|V|R|W|X|D|LRU|
|---|---|---|---|---|---|---|---|
|0x01|0x11|1|1|1|0|1|4|
|0x05|0x20|1|1|1|0|1|0|
|0x10|0x13|1|1|1|1|1|5|
|0x20|0x12|1|0|1|0|1|1|
|0x03|0x17|1|1|1|0|1|2|
|0x11|0x14|1|1|0|0|0|3|
|0xAC|0x15|1|1|0|0|0|6|
|0x34|0x16|1|1|1|0|1|7|

---

## 例题 3：**3-entry TLB + LRU + 需求分页 + 还要更新页表**（和你图里“3 项 TLB”最像）

来源：Pitt CS1541 optional homework solution ([皮特大学计算机科学系](https://people.cs.pitt.edu/~musfiq/teaching/cs1541/fall%202008/optional_vm_answer.pdf "Microsoft Word - optional_vm_answer.docx"))

### 题目（等价复述）

- VA=16-bit（按字节寻址），页大小=8KB=2¹³  
    ⇒ Offset=13bit，VPN=3bit（8 个虚拟页）
    
- PA=16-bit；进程 A 只分到 **4 个连续物理页框**，起始物理地址 0x4000  
    ⇒ 可用 PPN 为 {2,3,4,5}
    
- TLB：3 项、全相联；TLB 项含 Valid/Dirty/VPN/PPN；TLB 与物理页框都采用 **LRU 替换**
    
- 初始：TLB 与页表都为空；纯需求分页（访问才装入）
    
- 访问序列（VA，读写）：
    
    1. 0xA1F4 R
        
    2. 0xFEA6 R
        
    3. 0xE208 W
        
    4. 0x2020 R
        
    5. 0xB03E W
        
    6. 0xD021 W
        
    7. 0x689A R
        
    8. 0x345C W
        
    9. 0xCFDC W
        
    10. 0x7ED2 W
        
    11. 0x8038 R
        

要求：对每次访问判断 **TLB hit/miss、是否 page fault**，并给出每步后的 TLB/页表变化（最终状态也可）。

---

### 解答（完整逐步表）

先算 VPN：VPN = VA[15:13]（即高 3 bit）。

我把每步后的 TLB 三个槽（E0/E1/E2）写成 `VPN→PPN(D=0/1)`；空槽用 `-`。

|步|VA|R/W|VPN|TLB|PF?|TLB(E0,E1,E2)|
|--:|---|---|--:|---|---|---|
|1|0xA1F4|R|5|Miss|Y|VPN5→PPN2(D=0), -, -|
|2|0xFEA6|R|7|Miss|Y|VPN5→PPN2(D=0), VPN7→PPN3(D=0), -|
|3|0xE208|W|7|Hit|N|VPN5→PPN2(D=0), VPN7→PPN3(D=1), -|
|4|0x2020|R|1|Miss|Y|VPN5→PPN2(D=0), VPN7→PPN3(D=1), VPN1→PPN4(D=0)|
|5|0xB03E|W|5|Hit|N|VPN5→PPN2(D=1), VPN7→PPN3(D=1), VPN1→PPN4(D=0)|
|6|0xD021|W|6|Miss|Y|VPN5→PPN2(D=1), VPN6→PPN5(D=1), VPN1→PPN4(D=0)|
|7|0x689A|R|3|Miss|Y|VPN5→PPN2(D=1), VPN6→PPN5(D=1), VPN3→PPN3(D=0)|
|8|0x345C|W|1|Miss|N|VPN1→PPN4(D=1), VPN6→PPN5(D=1), VPN3→PPN3(D=0)|
|9|0xCFDC|W|6|Hit|N|VPN1→PPN4(D=1), VPN6→PPN5(D=1), VPN3→PPN3(D=0)|
|10|0x7ED2|W|3|Hit|N|VPN1→PPN4(D=1), VPN6→PPN5(D=1), VPN3→PPN3(D=1)|
|11|0x8038|R|4|Miss|Y|VPN4→PPN2(D=0), VPN6→PPN5(D=1), VPN3→PPN3(D=1)|

解释关键替换点：

- 第 6 步 VPN6 第一次出现：还有空闲物理页框 PPN5，可直接分配；但 TLB 已满，需要把 **TLB 中最久未用**的 VPN7 换出。
    
- 第 7 步 VPN3：物理内存 4 帧已满，按 LRU 换出最久未用的 **VPN7(占 PPN3)**，VPN3 复用 PPN3。
    
- 第 11 步 VPN4：按 LRU 换出 **VPN5(占 PPN2)**，VPN4 复用 PPN2。
    

**最终页表（VPN: V/D/PPN）**

- VPN1：V=1, D=1, PPN=4
    
- VPN3：V=1, D=1, PPN=3
    
- VPN4：V=1, D=0, PPN=2
    
- VPN6：V=1, D=1, PPN=5
    
- 其余 VPN：V=0  
    （题目原解里也给出了同类过程表）([皮特大学计算机科学系](https://people.cs.pitt.edu/~musfiq/teaching/cs1541/fall%202008/optional_vm_answer.pdf "Microsoft Word - optional_vm_answer.docx"))
    

顺手给你两个“自测指标”：

- TLB 命中：4/11 ≈ 36.36%
    
- Page fault：6 次
    

---

## 例题 4：4-entry TLB + LRU，只执行 1 条 store，但要同时考虑“取指 + 访存”两次地址翻译

来源：MIT 6.191 Quiz #3 Solutions（Virtual Memory 部分）

### 题目（等价复述）

- 处理器加入 4 项全相联 TLB，LRU 替换
    
- 程序暂停在即将执行一条指令前：该指令位于 VA=0xB2A0，且寄存器 x4=0x9204  
    指令：`sw x3, 4(x4)`（会产生：**取指访问 0xB2A0**，以及 **数据写访问 0x9208**）
    
- 给定当前 TLB 内容（VPN/V/R/D/PPN 等），以及页表信息（可据此查到 VPN 的映射）
    
- 要求：执行完这条 `sw` 后，写出更新后的 TLB（允许写 “NO CHANGE”）。
    

---

### 解答（完整逻辑）

`sw` 至少触发两次翻译：

1. **取指**：VA=0xB2A0 ⇒ VPN=0xB（页大小由题中地址划分可推出高位为 VPN）
    
    - 初始 TLB 没有 VPN=0xB ⇒ **TLB miss**，从页表装入 VPN 0xB→PPN 0xD（占用原本无效/可替换项），并更新 LRU
        
2. **数据写**：EA = x4 + 4 = 0x9204 + 0x0004 = 0x9208 ⇒ VPN=0x9
    
    - 初始 TLB 有 VPN=0x9 ⇒ **TLB hit**
        
    - 因为是写 ⇒ 把该项 **D 置 1**，并更新 LRU
        

更新后的 TLB（题解给出的填写结果）：

- 新增：VPN 0xB，V=1，R=1，D=0，PPN=0xD
    
- VPN 0x9：D 从 0 变为 1
    
- 其余项保持不变（NO CHANGE）
    

---

如果你希望我再“更贴近你图片那题”的口味（**8-bit VA、物理内存 128B、页 16B、TLB=3 项**那种超小玩具模型），我也可以按同样风格：

- 给你再找 2–3 道更小规模的公开题；或
    
- 直接把你这道题“改参数出 5 道变式题 + 标准答案（含命中率/最终TLB/页表）”。