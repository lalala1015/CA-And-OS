一个程序员，写了如下 C 语言代码。他想在多核处理器上运行该程序，用两个线程，每个线程占一个核。处理器采用顺序一致性协议，变量 X 和 flag 存储在内存中，变量 a 和 b 存储在寄存器中。所有内存初始化为 0。假设每一行 C 代码代表一条指令。

| Thread T0                    | Thread T1            |
| :--------------------------- | :------------------- |
| 指令 T0.0 X[0] = 1;            | 指令 T1.0 X[0] = 0;    |
| 指令 T0.1 X[0] += 1;           | 指令 T1.1 flag[0] = 1; |
| 指令 T0.2 while(flag[0] == 0); | 指令 T1.2 b = X[0];    |
| 指令 T0.3 a = X[0];            |                      |
| 指令 T0.4 X[0] = a*2;          |                      |

1. 变量 a 的最终值可能是多少？ 解释原因

2. 变量 X[0]的最终值可能是多少？解释原因。

3. 变量 b 的最终值可能是多少？解释原因。

4. 假设该程序员想让变量 a 和 b 的取值在程序执行完毕时是相同的，那么在保留 T1.1 和 T0.2 两条指令的前提下，需要对原始程序如何做最小的改动（填写下表）？（提示：可以利用更多的 flags）